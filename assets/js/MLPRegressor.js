var MLPRegressor = function(hidden, layers, weights, bias) {

    this.hidden = hidden.toUpperCase();
    this.network = new Array(layers.length + 1);
    for (var i = 0, l = layers.length; i < l; i++) {
        this.network[i + 1] = new Array(layers[i]).fill(0.);
    }
    this.weights = weights;
    this.bias = bias;

    var compute = function(activation, v, nLayers) {
        switch (activation) {
            case 'LOGISTIC':
                if (nLayers > 1) {
                    for (var i = 0, l = v.length; i < l; i++) {
                        v[i] = 1. / (1. + Math.exp(-v[i]));
                    }
                } else {
                    for (var i = 0, l = v.length; i < l; i++) {
                        if (v[i] > 0) {
                            v[i] = -Math.log(1. + Math.exp(-v[i]));
                        } else {
                            v[i] = v[i] - Math.log(1. + Math.exp(-v[i]));
                        }
                    }
                }
                break;
            case 'RELU':
                for (var i = 0, l = v.length; i < l; i++) {
                    v[i] = Math.max(0, v[i]);
                }
                break;
            case 'TANH':
                for (var i = 0, l = v.length; i < l; i++) {
                    v[i] = Math.tanh(v[i]);
                }
                break;
            case 'SOFTMAX':
                var max = Number.NEGATIVE_INFINITY;
                for (var i = 0, l = v.length; i < l; i++) {
                    if (v[i] > max) {
                        max = v[i];
                    }
                }
                for (var i = 0, l = v.length; i < l; i++) {
                    v[i] = Math.exp(v[i] - max);
                }
                var sum = 0.0;
                for (var i = 0, l = v.length; i < l; i++) {
                    sum += v[i];
                }
                for (var i = 0, l = v.length; i < l; i++) {
                    v[i] /= sum;
                }
                break;
        }
        return v;
    };

    this.predict = function(neurons) {
        this.network[0] = neurons;
    
        for (var i = 0; i < this.network.length - 1; i++) {
            for (var j = 0; j < this.network[i + 1].length; j++) {
                this.network[i + 1][j] = this.bias[i][j];
                for (var l = 0; l < this.network[i].length; l++) {
                    this.network[i + 1][j] += this.network[i][l] * this.weights[i][l][j];
                }
            }
            if ((i + 1) < (this.network.length - 1)) {
                this.network[i + 1] = compute(this.hidden, this.network[i + 1], this.network.length);
            }
        }
    
        if (this.network[this.network.length - 1].length > 1) {
            return this.network[this.network.length - 1];
        }
        return this.network[this.network.length - 1][0];
    };

};

var predict=function(features) {
        // Parameters:
        const layers = [100, 1];
        const weights = [[[-0.022057690663418898, -0.14916879482488865, -0.07814904379550777, -0.06891397087569716, -0.03936732879352408, 0.2563158263808424, -0.022671604311378962, 0.08922560509077751, 0.14366655203026926, -0.08060295746548465, -0.09275136157680253, -0.041519896875520115, -0.18874583005561715, 0.1753200510037076, 0.14741542365142646, 0.015155978738834416, -0.06978230302825202, 0.1383065329238904, 0.05112535582100129, -0.02810393985018275, 0.0012490009483396374, -0.008048792986314697, 0.22355561329953352, 0.016581677427633175, 0.060678776543914556, -0.19436951766831612, -0.050486133642597214, -0.1624863838918318, -0.17231251087821575, 0.1547332071554687, 0.16003196454878754, 0.12131213330729683, 0.12974244357348505, -0.007833597674212284, 0.18643797748388272, -0.023222573517993294, 0.05431112765526915, 0.04232131401321556, 0.02484838486234864, -0.0917106591318509, 0.06724949344194035, 0.19897792741139306, 0.0994553349072458, -0.013219301938856835, 0.15121060699997715, 0.09330240450480905, 0.07319013732190371, -0.13267078830777923, 0.17117369568488425, -0.029207822646267482, -0.062631611855379, 0.030675138049977603, 0.0022801613710455903, -0.07820310902969159, 0.14227961064432343, -0.10976745848441777, -0.08963119238390128, 0.05663561728715653, -0.003929525933443521, -0.15500445872421958, -0.12661197431482202, -0.16573969566089533, -0.0042096279597435855, 0.008326771771960631, 0.1991581297245333, 0.059125898398389505, 0.00516954432807921, 0.15312700949129374, 0.21898657248596817, -0.07953854627300062, 0.10646212118273936, 0.23918650984639583, -0.11141810030381069, 0.0828945701636005, 0.13586396463105796, 0.15947678884210825, 0.1472703950773888, -0.02151658063799906, -0.2553416955470077, -0.17198670186362705, -0.18127921319377882, 0.02178155602573082, -0.030766677987299304, -0.2031018750612946, 0.1280754323920758, 0.1098837154747401, 0.12727938253708457, 0.18072498671555706, -0.02843217487543021, 0.1376222972069515, 0.019816599167544347, 0.03401830745320113, -0.06141095496173279, 0.0672600964208752, -0.016394246547083206, 0.03766446239710272, -0.02581408567175999, -1.7991478059689892e-05, 0.15102771086598824, -0.07519384349552692], [-0.23431290943493452, -0.0371098799621621, -0.02266485796131897, -0.02564083349049908, -0.18617156210225477, 0.05817456631502777, 0.18169126033306324, -0.09704858286957535, -0.11841502916588457, 0.21862495156383627, 0.07962880224547175, 0.023032595141884844, -0.07612330488917972, 0.03817594836649548, 0.0004095306556542192, -0.1629292689031323, -0.07795005084769006, 0.11261851641305591, -0.11666967337485197, 0.1453741013618835, 0.021599541145385086, -0.24998530763836896, -0.04312618294808878, -0.16877662434069235, -0.19712710053019633, -0.1342954674500371, -0.11490032790833585, 0.1363559416194106, 0.17465034474727667, -0.08625108198315524, -0.022961820127087376, 0.0051125156581453305, 0.17612862553067032, -0.0637598315436967, -0.17501263873614595, -0.008707841231088798, 0.14447811545272266, 0.025862463950415242, -0.021316402458716376, -0.02346209599930743, -0.11068765949131579, -0.06819596409610695, -0.020566582924560182, 0.08495856152838521, 0.0988543989961349, -0.1710280307543983, 0.08493956385410213, 0.08950236446547312, -0.13722896725190856, 0.18082699119937648, 0.05125062341829674, 0.1402831903974783, -0.10457310545637118, -0.1645578747723103, 0.08090407848708914, 0.16850900198505453, -0.17731487043573438, 0.1777429785030736, 0.07168647395456634, 0.16768852903875006, -0.07113058131183957, -0.13848013767937828, -0.052140223677070524, -0.06951623737932644, -0.02372093054444309, -0.15742933805326653, 0.07561613141035581, -0.12602805803353728, 0.05249469121233358, 0.006675833309611073, -0.10831214810199413, 0.007333107030847986, 0.0002860994168407185, 0.12608148105675768, -0.22113064010684322, 0.06563041736291968, -0.13783104537812743, 0.0903509271803832, 0.04581677969737022, -0.16222859008565202, 0.06800651293844147, -0.04577192164770211, 0.01066523009718493, 0.09729878403503792, -0.10981226343102557, -0.08006277635292004, -0.15646346766216646, -0.14791099495567123, 0.226915516895824, 0.24379404119419468, -0.17293305161425754, -0.1642208607096109, -0.14324966241276813, -0.18080228327489042, 0.1468358681938035, -0.1193830363755657, -0.03728232596347653, -0.15038603287404248, -0.04884692522092026, 0.1822709184118764], [0.17148105884724468, 0.15419945836219348, -0.03034507471460159, 0.07541202335778346, -0.20135144869268395, 0.01960346124487342, -0.1374011774026522, 0.07382980530007488, -0.011099159194787916, -0.06945199943048862, 0.10057811181869651, -0.07509770710985073, -0.02631748401974221, -0.1845455548527317, -0.18511952315794467, 0.01621544182491026, -0.05108031039741663, -0.033426932540154906, -0.03762913224254004, -0.057240528763510566, -0.11302330238663486, 0.20812963413037427, 0.1499576827027251, 0.17509440528790648, -0.007091638892111179, -0.10539429356758019, -0.002704887328934732, 0.0218835504923878, -0.018986877045225475, -0.016282286264722074, -0.0800045168503324, -0.19165727833018129, 0.08633635751392076, -0.0797448876948512, -0.1661613676140447, 0.0019001647715466538, -0.03152244145525686, 0.1508163079832924, -0.1643248270078992, -0.032591523393018566, -0.020215192774494368, 0.05600812483532368, 0.10396650254720963, 0.20594710265189073, -0.005432153274100932, -0.1439926319868101, 0.07205418399900072, -0.0019490435896372025, 0.07014953227089339, -0.03954553897704624, -0.10341919931911635, -0.04664695949525614, 0.03793554081237247, 0.16923808908500915, 0.17870697789334095, 0.06325590028534908, 0.12862683424038676, -0.1479829994212212, 0.10152114121809476, 0.07599321134284863, -0.1030374401469456, -0.14835789242309813, -0.0360865731307476, -0.041998768332721384, -0.2044772959365662, -0.13807755123797283, 0.044988052788381354, 0.16377368223239588, -0.09745315209383777, -0.13934139803248188, 0.15483179299803548, 0.012663264834950219, 0.06703363487383905, 0.16802208379089323, -0.04525971772386484, -0.1398763710188102, -0.10365160418278736, -0.20254367575325485, 0.025071177809371237, 0.020446271362789648, 0.05723238850607989, 0.04948177624778142, -0.08631618070194093, 0.021506945798682883, -0.10201927395182234, 0.043750371027157856, 0.08142978755017924, -0.12300566263890803, -0.20606349821611036, 0.15134245953809905, -0.22560610530545724, 0.046077921510445645, 0.08238902254361308, 0.08501853109168318, 0.18557556909150674, 0.08179664753862127, -0.11292973351744967, -0.02100496601559973, -0.11425561274600857, 0.1040665000392987], [-0.05054007223536927, -0.06989939322094535, 0.01527777450849918, 0.11207121075356807, 0.23211806491618436, -0.06258102221724508, -0.08788522232654339, 0.06372935812316548, 0.18851444344270635, -0.2192842979309882, -0.14016327838884232, -0.027463205919869855, -0.15122827314795576, -0.009527368338292184, 0.1144607540127039, 0.046171757291964086, -0.17065072203859255, -0.021808696161047546, 0.18871254080877342, -0.07666219147728376, -0.12638202919009373, -0.14442261119596034, 0.21327124378197004, -0.047155160155200826, -0.18185986251764769, -0.07628210432605863, 0.015451179498280574, -0.015013288672751212, 0.03406953609230492, 0.009687660106025392, 0.0621095710814199, 0.17084065833668616, 0.1943114219906065, -0.07380742712477042, 0.14924165042777593, -0.07247001951879656, -0.07287424036463634, 0.1886238935758323, -0.0070974961968883945, 0.026996381118643793, -0.10418126480897417, 0.1889621558460851, 0.1795933481605385, 0.1595399243693222, -0.043059980527308944, -0.1029976431940064, 0.13752885396860307, -0.09230330656119888, 0.09126626037714512, 0.09723365678646836, -0.16326958055851068, -0.0847687213332749, -0.07985883926771861, -0.11906221136358769, 0.011860458860016352, -0.03902449195411187, -0.052502195239085524, 0.15575336728737663, -0.058296310676927025, 0.0009749361237040699, -0.158631666766646, -0.1953615901535397, 0.023203424474465585, -0.09528832880131868, -0.10040950779026617, -0.12074483466549023, -0.056802512660863336, 0.16477436211886917, 0.18344600982542247, 0.05895037905761385, 0.06214323637323709, 0.1820507000358288, 0.027116016781295375, 0.15620653439123622, 0.10745083757258647, -0.10867656150234042, 0.09241854186246162, 0.08975479318193866, -0.04599158088923471, -0.04234558700579811, 0.05011923212785397, -0.07907747521232046, -0.0430076101077576, -0.07274762856000559, 0.06218793531667335, 0.0029598796957067477, 0.22126872786113605, 0.22129339419125568, -0.05215392603453836, 0.060807495955162466, 0.21256893590179127, 0.021546987315869702, 0.10737379554784583, -0.1541657935539229, 0.03283514504328326, 0.12152254977415283, 0.0768676065689767, -0.10586415710973758, -0.15806003552779688, 0.13955294226926673], [-0.13240255936809622, 0.1819022894695911, -0.04707405616614481, -0.1315587748884336, -0.021849934895447544, 0.1472381490729538, -0.12816665452211787, 0.02033244506843572, 0.19459792586887117, -0.09254814665497668, -0.22574700882298543, -0.013307384019348265, -0.10816905920254324, -0.01726163250154614, -0.08247221749615401, -0.14546042341056956, -0.10280918839296027, -0.0461359589715974, 0.01328340640806063, 0.07867539225861796, 0.16696482819203345, 0.10082613418417369, -0.011795680559027036, -0.1612697141219122, 0.18012127908731493, -0.02521622429302692, -0.14064089197502258, 0.02504813606059499, -0.11980874917741716, -0.15193856039511822, 0.11258503120711777, 0.046004586642475184, -0.15249934691643507, -0.08966631458746939, 0.06466035787084173, 0.09419869975560288, -0.09395047033964206, -0.02877296669142458, 0.03594378152668384, -0.15960898883440355, -0.04915417947525865, 0.10120944938544404, 0.06641773334849882, -0.14282386668302427, -0.14264366513844637, 0.0543694904841903, 0.01899897775454391, -0.16905744798210273, -0.05507055520627639, 0.027743759618529925, 0.04160767261039568, -0.17309432013158166, -0.08711203325240466, -0.16310141928665878, -0.041575414804615754, 0.1407891629596881, 0.000812314524504154, 0.14880390621545017, -0.02683377823923219, 0.035504114257135656, -0.15365048400927325, -0.05868946412229868, -0.16965531361925332, 0.025285577491698307, 0.015576435102905389, 0.204496636954375, -0.0032684833421857927, -0.14811203139612966, 0.2170211524372265, -0.09053549735190168, 0.12329555054632793, 0.16442140102049924, 0.10106893407688655, 0.16213205391444616, -0.1053593786988967, -0.094750140988148, -0.10457604312856779, -0.08588478692052068, 0.1506478946763514, -0.028863853510328656, -0.02730361177200936, -0.0358805862018167, 0.16803815808629358, -0.22067713226602453, -0.08604804910099371, -0.17738201148418883, 0.17346661943390657, 0.044068651997802265, -0.13796744047883178, -0.014396570046014143, -0.0020183401051638355, -0.05058876922502215, -0.18640944811409896, 0.23564573352304993, 0.2456870042251416, -0.0030081736386879917, 0.024868340781737216, -0.17499386052181704, 0.03560509830283129, 0.12157983174060005]], [[-0.21596606142097652], [-0.0912154221039783], [-0.05986812819457929], [-0.03775766182825341], [0.17552915135985048], [0.22907342332848252], [-0.10009705705828376], [0.07409123495886417], [0.25412505408084757], [0.018205438952095077], [-0.20569771777982543], [0.010302443425893542], [-0.20831340474460705], [0.1635018349324633], [-0.04079543798413172], [-0.223053522538517], [0.17036970480824729], [-0.11478845708270073], [0.0658348829633629], [0.09516389174176608], [-0.0974739845885158], [-0.08579681124532165], [0.2171546788006599], [0.11829566807020082], [-0.07788351333386968], [0.09692347704869321], [0.12692302074995457], [-0.16185563257863797], [-0.17575698789904362], [-0.08010301390418213], [0.07862235503466591], [0.1653032586653568], [0.09533615019803966], [-0.19091165140586958], [-0.19474899397122586], [0.12074974677736969], [0.010757393979748807], [-0.04362251801417068], [0.05932287280257106], [0.05564221804622474], [-0.05820061980447139], [0.09334516447842922], [-0.0004807828488667265], [0.2303857830667326], [0.0925481074397609], [-0.1569280710981459], [-0.2144662752529083], [0.04589587589096302], [0.011257069096329739], [0.008876098609074786], [0.18387721028484122], [0.004350512169146783], [0.036990272184496346], [0.16786017008534518], [-0.149274117576659], [-0.07006281444797036], [0.03426261107766536], [-0.0757942787998389], [0.11862249009620539], [-0.06506548467029301], [0.1261589459177537], [0.07773779432215094], [0.13433638327292485], [0.12370169052282494], [-0.16901203254323724], [0.15827308001023843], [-0.18286665969263838], [0.02167560560180495], [0.1319438479549869], [0.07512177067816833], [0.24736692654964418], [0.06279188727470944], [0.03199459349257579], [-0.028197652005033585], [0.016845208380589536], [0.14830339902787149], [-0.008945070827672692], [0.02352798884593867], [-0.0973211141296809], [-0.11446714368246626], [-0.06489370162767594], [0.13391683123016535], [0.17014456466270536], [-0.08547251072257324], [-0.016675093811801274], [0.13778365035397688], [0.026828251679699055], [0.07747116691258578], [0.05344643249192793], [0.1284592076389465], [0.07185317418909373], [-0.023609715462488384], [0.08986212488080147], [0.06534648709309304], [0.12101822629680166], [0.25729050121537284], [-0.22157768634140382], [-0.05073662656659834], [-0.014035870738110554], [-0.0031990890292307983]]];
        const bias = [[0.1476641431192644, 0.19839296580040067, -0.1207632717828272, 0.17170325809622722, 0.19745440051288993, 0.08164032708221854, -0.09656498231543173, -0.021707754060095785, 0.11020127311834912, 0.21990723311806262, 0.2110109735573226, -0.12417342823764611, 0.0440691343417059, -0.08479230463171991, -0.07473344819406877, -0.013273661895760427, 0.15569151153226868, -0.22193375745860996, -0.04220544779461094, -0.14877687917433213, -0.06902591241043302, 0.1707795952903515, 0.24204918287807495, -0.03107423355278241, 0.12431039457028521, 0.1475347186193052, -0.1514820753605489, -0.2281688271784707, 0.04171990064188715, -0.06270899824678108, -0.23136840243409604, 0.11114454776796882, 0.058646568461861746, -0.1323841951873941, 0.1237297455729232, -0.1834409785277002, -0.011128734208771751, -0.04708432718113613, -0.07704935273625063, -0.032775015705027305, 0.2177615630409392, 0.21189033273353816, -0.11640722122014611, 0.23594354112191554, -0.08065590879631199, -0.2233990558513765, -0.03460620930211547, -0.19389709959644286, 0.21191362806680897, -0.15058500880226666, -0.0646084525709725, -0.010151052045237474, 0.03277638867967171, -0.14333183544724187, 0.13049770966204366, -0.1007855136924582, -0.0683640723013609, 0.15163907013637853, -0.17600726101800823, -0.1458689078067335, -0.16398388846655756, 0.08253448458701823, -0.18760003618252674, -0.052828364569745045, 0.07958890686924201, 0.19820972776604606, -0.0517264213851108, -0.061387837488623365, 0.033098971468685456, -0.22173610962505136, 0.20697912400303217, 0.1381707610403131, 0.2082975099515824, 0.16951906272284525, 0.10799496394964773, -0.14132771044003117, 0.064463684806685, 0.22745198533168345, 0.18215706612102084, -0.09107883419678395, -0.14243078217152738, -0.08885894207557685, -0.11894706835203277, 0.017761389699948768, -0.23816404563885077, -0.1393544571731381, 0.1252170774760704, 0.11976602396285253, 0.045129368875609165, 0.11912184836739595, -0.016367272039353023, 0.21084878088354822, -0.21575214677007531, 0.0737804846832296, 0.10311688075988756, 0.07065913373062133, 0.10377640969710242, -0.1828481584291302, -0.1334954213072369, -0.04782892001259459], [-0.17115067131139494]];

        // Prediction:
		const data_norm=3855.2872785306154;
        var reg = new MLPRegressor('relu', layers, weights, bias);
        var prediction = reg.predict(features)*data_norm;
        console.log(prediction);
		return prediction;

    }

   function predictButton(){
       var temp=document.getElementById("temperature").value;
       var turb=document.getElementById("turbidity").value;
       var pH=document.getElementById("pH").value;
       var cond=document.getElementById("conductivity").value;
       var DO=document.getElementById("dissolvedOxygen").value;

       if(temp==="" || turb==="" || pH==="" || cond==="" || DO===""){
           alert("Please make sure you enter all parameters!");
           return;
       }

       const x_norm=16244.055980958083;
       var prediction= predict([parseFloat(temp)/x_norm,parseFloat(turb)/x_norm,parseFloat(pH)/x_norm,parseFloat(cond)/x_norm,parseFloat(DO)/x_norm]).toFixed(2);
       

       document.getElementById("resultsDiv").innerHTML='<div class="card-body card-block"><div id="myProgress"><div id="myBar"></div></div></div>';
       move();

       setTimeout(function(){document.getElementById("resultsDiv").innerHTML='<div class="card-body card-block"><br><h1 id="predictionResult" width=100% style="text-align:center">'+prediction+'<h1><h4 width=100% style="text-align:center">Colonies/mL</h4></div>';}, 2000);

   }

var i = 0;
function move() {
  if (i == 0) {
    i = 1;
    var elem = document.getElementById("myBar");
    var width = 1;
    var id = setInterval(frame, 10);
    function frame() {
      if (width >= 100) {
        clearInterval(id);
        i = 0;
      } else {
        width++;
        elem.style.width = width + "%";
      }
    }
  }
}